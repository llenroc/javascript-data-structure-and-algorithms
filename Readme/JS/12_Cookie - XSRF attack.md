[Cookie reference document](https://javascript.info/cookie)



`XSRF (cross-site request forgery)` attacks.

> Cookies are `small strings of data` that are `stored directly in the browser`. They are a `part of the HTTP protocol`, defined by the RFC 6265 specification.

> Cookies are usually `set by a web-server` using the `response Set-Cookie HTTP-header`. Then, the browser automatically adds them to (almost) every request to the same domain using the Cookie HTTP-header.


### One of the most widespread use cases is authentication:

1. Upon sign in, the server uses the Set-Cookie HTTP-header in the response to set a cookie with a unique “session identifier”.

2. Next time when the request is sent to the same domain, the browser sends the cookie over the net using the Cookie HTTP-header.
So the server knows who made the request.

3. We can also access cookies from the browser, using document.cookie property.


4.  The value of document.cookie consists of name=value pairs, delimited by ;. Each one is a separate cookie. 

5. To find a particular cookie, we can split document.cookie by ;, and then find the right name. We can use either a regular expression or array functions to do that.

6. A write operation to document.cookie updates only cookies mentioned in it, but doesn’t touch other cookies.

```
document.cookie = "user=John"; // update only cookie named 'user'
alert(document.cookie); // show all cookies
```

## Limitations 

There are few limitations:

> The name=value pair, after encodeURIComponent, should not exceed 4KB. So we can’t store anything huge in a cookie.

> The total number of cookies per domain is limited to around 20+, the exact limit depends on the browser.


## Cookies have several options, many of them are important and should be set.

1. path ( `path=/mypath `)

2. domain (`domain=site.com`)

3. expires, max-age (`expires=Tue, 19 Jan 2038 03:14:07 GMT`) (`max-age=3600`)

> By default, if a cookie doesn’t have one of these options, it disappears when the browser is closed. Such cookies are called “session cookies”

4. secure

> The cookie should be transferred only over HTTPS.

> By default, if we set a cookie at http://site.com, then it also appears at https://site.com and vice versa.

> `With this option`, if a cookie is set by https://site.com, then it `doesn’t appear when the same site is accessed by HTTP, as http://site.com. So if a cookie has sensitive content that should never be sent over unencrypted HTTP, the secure flag is the right thing.

5. samesite  (`samesite=strict (same as samesite without value)`)

> That’s another security attribute samesite. It’s designed to protect from so-called `XSRF (cross-site request forgery) attacks`.


### XSRF attack

Imagine, you are logged into the site bank.com. That is: you have an authentication cookie from that site. Your browser sends it to bank.com with every request, so that it recognizes you and performs all sensitive financial operations.

Now, while browsing the web in another window, you accidentally come to another site evil.com. That site has JavaScript code that submits a form <form action="https://bank.com/pay"> to bank.com with fields that initiate a transaction to the hacker’s account.

The browser sends cookies every time you visit the site bank.com, even if the form was submitted from evil.com. So the bank recognizes you and actually performs the payment.

That’s a so-called “Cross-Site Request Forgery” (in short, XSRF) attack.

Real banks are protected from it of course. All forms generated by bank.com have a special field, a so-called `“XSRF protection token”`, that an evil page can’t generate or extract from a remote page. It can submit a form there, but can’t get the data back. The site bank.com checks for such token in every form it receives.

Such a protection takes time to implement though. We need to ensure that every form has the required token field, and we must also check all requests.


 5. httpOnly ()

 > This option forbids any JavaScript access to the cookie. We can’t see such a cookie or manipulate it using document.cookie.



 ## Appendix: Cookie functions

 1.  `getCookie(name)`

 > The function getCookie(name) returns the cookie with the given name:

 ```
  // returns the cookie with the given name,
  // or undefined if not found
  function getCookie(name) {
    let matches = document.cookie.match(new RegExp(
      "(?:^|; )" + name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, '\\$1') + "=([^;]*)"
    ));
    return matches ? decodeURIComponent(matches[1]) : undefined;
  }
 ```

 2. `setCookie(name, value, options)`

 3. `deleteCookie(name)`

 ```
 function deleteCookie(name) {
  setCookie(name, "", {
    'max-age': -1
  })
}
 ```

